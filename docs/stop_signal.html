<!DOCTYPE html>
<html class=''>

<head>
    <meta charset='UTF-8'>
    <meta name="robots" content="noindex">
    <title>Stop signal task</title>
    <link rel='stylesheet' type='text/css' href='https://users.rcc.uchicago.edu/~kywch/RC-RAGE_jsPsych/lib/rc-rage.css'>
</head>

<body>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>
    <script src='https://cdn.jsdelivr.net/gh/kywch/RC-RAGE_jsPsych@master/lib/jspsych.js'></script>
    <script src='https://cdn.jsdelivr.net/gh/kywch/RC-RAGE_jsPsych@master/lib/jspsych-fullscreen.js'></script>
    <script src='https://cdn.jsdelivr.net/gh/kywch/RC-RAGE_jsPsych@master/lib/jspsych-instructions.js'></script>
    <script src='https://users.rcc.uchicago.edu/~kywch/RC-RAGE_jsPsych/stop-it/jspsych-html-keyboard-response.js'>
    </script>
    <script src='https://users.rcc.uchicago.edu/~kywch/RC-RAGE_jsPsych/stop-it/jspsych-stop-signal-plugin.js'></script>
    <script src='https://users.rcc.uchicago.edu/~kywch/RC-RAGE_jsPsych/stop-it/jspsych-detect-held-down-keys.js'>
    </script>
    <script src='https://users.rcc.uchicago.edu/~kywch/RC-RAGE_jsPsych/stop-it/sprintf.js'></script>
    <script src='https://users.rcc.uchicago.edu/~kywch/RC-RAGE_jsPsych/stop-it/stop-it_main.js'></script>

    <script>
        $(document).ready(function () {

            // set the display stage
            jQuery('<div class = display_stage_background></div>').appendTo('body');
            jQuery('<div class = display_stage></div>').appendTo('body');

            var takeBackAmount = "0";

            sbjId = "test";
            task_id = "stop";
            data_dir = "data_sst";

            var jspsych_session = [];

            // use the full screen

            jspsych_session.push({
                type: 'fullscreen',
                fullscreen_mode: true
            });

            jspsych_session.push(generate_instruction_block(NexpBL));

            jspsych_session.push(generate_practice_block());

            jspsych_session.push(start_main_page);
            jspsych_session.push(generate_main_block(NexpBL));

            // exit the full screen
            jspsych_session.push({
                type: 'fullscreen',
                fullscreen_mode: false
            });

            jsPsych.init({
                timeline: jspsych_session,
                preload_images: [fix_stim, go_stim1, go_stim2, stop_stim1, stop_stim2],

                display_element: document.querySelector('.display_stage'),

                on_data_update: function (data) { // each time the data is updated:
                    // write the current window resolution to the data
                    data.window_resolution = window.innerWidth + ' x ' + window.innerHeight;
                    // is the experiment window the active window? (focus = yes, blur = no)
                    data.focus = focus;
                    data.Fullscreen = fullscr_ON;
                },

                on_interaction_data_update: function (data) {
                    //interaction data logs if participants leaves the browser window or exits full screen mode
                    interaction = data.event;
                    if (interaction.includes("fullscreen")) {
                        // some unhandy coding to circumvent a bug in jspsych that logs fullscreenexit when actually entering
                        if (fullscr_ON == 'no') {
                            fullscr_ON = 'yes';
                            return fullscr_ON
                        } else if (fullscr_ON == 'yes') {
                            fullscr_ON = 'no';
                            return fullscr_ON
                        }
                    } else if (interaction == 'blur' || interaction == 'focus') {
                        focus = interaction;
                        return focus;
                    }
                },

                on_finish: function () {
                    // clear the stage
                    jQuery('.display_stage').remove();
                    jQuery('.display_stage_background').remove();
                }
            });
        });
    </script>
</body>

</html>
